# 🔧 修复"无效的认证令牌"问题

## 问题原因

"无效的认证令牌"错误通常由以下原因引起：

1. **Token过期**：JWT token已过期（默认7天）
2. **Token格式错误**：Token没有正确保存或格式不正确
3. **JWT_SECRET不匹配**：后端重启后JWT_SECRET改变
4. **Token被清除**：浏览器清除了LocalStorage

## ✅ 已修复的功能

1. **自动检测token失效**：当API返回401/403错误时，自动清除token
2. **自动跳转登录**：token失效时自动跳转到登录页面
3. **错误提示改进**：显示更清晰的错误信息

## 🔄 解决方法

### 方法1：重新登录（推荐）

1. 点击页面上的"登出"按钮（如果有）
2. 或者直接访问登录页面
3. 重新输入用户名和密码登录
4. 系统会自动获取新的token

### 方法2：清除浏览器数据

1. 打开浏览器开发者工具（F12）
2. 切换到 Application 标签
3. 找到 Local Storage → `http://localhost:3000`
4. 删除 `auth_token` 键
5. 刷新页面，重新登录

### 方法3：检查后端配置

确保 `server/.env` 文件中的 `JWT_SECRET` 配置正确：

```env
JWT_SECRET=proreport-secret-key-change-this-in-production
```

如果后端重启后JWT_SECRET改变，所有已登录的用户都需要重新登录。

## 🧪 测试步骤

1. **清除旧token**：
   - 打开浏览器开发者工具（F12）
   - Application → Local Storage
   - 删除 `auth_token`

2. **重新登录**：
   - 访问登录页面
   - 输入用户名和密码
   - 点击登录

3. **验证token**：
   - 登录后检查 Local Storage 中是否有 `auth_token`
   - 尝试创建项目，应该可以成功

## 📝 预防措施

1. **定期检查登录状态**：应用会自动检查token有效性
2. **Token自动刷新**：未来可以添加token自动刷新功能
3. **记住登录状态**：登录后token会保存7天

## 🆘 如果问题仍然存在

1. 检查后端服务是否运行：`http://localhost:3001/api/health`
2. 检查浏览器控制台是否有其他错误
3. 检查网络请求（Network标签）中的Authorization头是否正确
4. 确认后端 `server/.env` 中的 `JWT_SECRET` 配置正确

