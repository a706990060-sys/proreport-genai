# 前后端分离架构 - 快速开始

## ✅ 已完成的工作

1. ✅ 创建了后端服务器（Express + TypeScript）
2. ✅ 实现了用户认证API（JWT）
3. ✅ 实现了项目管理API
4. ✅ 实现了资料库管理API
5. ✅ 实现了内容生成API（调用Gemini）
6. ✅ 创建了前端API客户端
7. ✅ 更新了前端服务调用后端API
8. ✅ 配置了Vite代理

## 🚀 启动项目

### 方式一：同时启动前后端（推荐）

```bash
cd F:\ProReport-GenAI
npm run dev
```

这会同时启动：
- 前端：http://localhost:3000
- 后端：http://localhost:3001

### 方式二：分别启动

**终端1 - 启动后端：**
```bash
cd F:\ProReport-GenAI\server
npm run dev
```

**终端2 - 启动前端：**
```bash
cd F:\ProReport-GenAI
npm run dev:client
```

## 📁 项目结构

```
F:\ProReport-GenAI\
├── server/                 # 后端服务器
│   ├── src/
│   │   ├── index.ts        # 服务器入口
│   │   ├── routes/         # API路由
│   │   ├── services/       # 业务逻辑
│   │   ├── middleware/     # 中间件
│   │   └── types/          # 类型定义
│   ├── data/               # 数据存储（自动创建）
│   ├── .env                # 环境变量
│   └── package.json
├── services/               # 前端服务
│   ├── apiClient.ts        # API客户端
│   ├── authService.ts      # 认证服务（已更新）
│   └── geminiService.ts    # 生成服务（已更新）
└── package.json            # 前端配置
```

## 🔧 配置说明

### 后端环境变量 (`server/.env`)

需要创建 `server/.env` 文件：

```env
PORT=3001
NODE_ENV=development
GEMINI_API_KEY=你的API密钥
JWT_SECRET=你的JWT密钥（随机字符串）
DATA_PATH=./data
FRONTEND_URL=http://localhost:3000
```

### 前端配置

Vite已配置代理，所有 `/api` 请求会自动转发到后端。

## 📡 API端点

### 认证
- `POST /api/auth/register` - 注册
- `POST /api/auth/login` - 登录
- `GET /api/auth/me` - 获取当前用户

### 项目
- `GET /api/projects` - 获取所有项目
- `POST /api/projects` - 创建项目
- `PUT /api/projects/:id` - 更新项目
- `DELETE /api/projects/:id` - 删除项目

### 资料库
- `GET /api/library/files` - 获取文件
- `POST /api/library/files` - 保存文件
- `GET /api/library/groups` - 获取分组
- `POST /api/library/groups` - 保存分组

### 生成
- `POST /api/generate/section` - 生成章节
- `POST /api/generate/refine` - 修改内容

## 🔐 安全特性

1. **JWT认证**：所有API需要Bearer Token
2. **密码加密**：使用bcrypt加密
3. **数据隔离**：每个用户数据独立存储
4. **API Key保护**：Gemini API Key只在后端使用

## 📝 数据存储

数据存储在 `server/data/` 目录：
- `users.json` - 用户数据
- `projects/{userId}.json` - 每个用户的项目
- `library/{userId}_files.json` - 每个用户的文件
- `library/{userId}_groups.json` - 每个用户的分组

## ⚠️ 注意事项

1. **首次运行**：需要创建 `server/.env` 文件
2. **端口冲突**：确保3000和3001端口未被占用
3. **数据迁移**：旧localStorage数据不会自动迁移，需要重新创建项目
4. **API Key**：确保后端 `.env` 文件包含有效的Gemini API Key

## 🐛 常见问题

**Q: 后端启动失败？**
A: 检查 `server/.env` 文件是否存在，确保GEMINI_API_KEY已配置

**Q: 前端无法连接后端？**
A: 确保后端在3001端口运行，检查CORS配置

**Q: 认证失败？**
A: 检查JWT_SECRET是否配置，token是否正确存储

## 📚 详细文档

更多信息请查看 `README_BACKEND.md`






