# 🔐 修复 API 密钥泄露问题

## ❌ 当前错误

错误信息：`Your API key was reported as leaked. Please use another API key.`

**原因**：当前的 Gemini API 密钥被 Google 标记为泄露，需要更换新的密钥。

## ✅ 解决步骤

### 步骤1：创建新的 API 密钥

1. **访问 Google AI Studio**
   - 打开：https://aistudio.google.com/
   - 使用你的 Google 账号登录

2. **删除旧的 API 密钥（可选但推荐）**
   - 在 API 密钥列表中，找到被标记为泄露的密钥
   - 点击删除按钮移除它（避免继续使用）

3. **创建新的 API 密钥**
   - 点击 **"Create API key"** 或 **"创建 API 密钥"**
   - 选择项目（如果没有，创建一个新项目）
   - **立即复制**新生成的 API 密钥
   - ⚠️ **重要**：密钥只显示一次，请立即保存

### 步骤2：在 Vercel 中更新环境变量

1. **访问 Vercel 控制台**
   - 打开：https://vercel.com/dashboard
   - 登录你的账号

2. **进入项目设置**
   - 点击项目 `proreport-genai`
   - 点击顶部 **"Settings"**（设置）
   - 在左侧菜单点击 **"Environment Variables"**（环境变量）

3. **更新 GEMINI_API_KEY**
   - 找到 `GEMINI_API_KEY` 这一行
   - 点击右侧的 **"Edit"**（编辑）按钮
   - 在 **"Value"** 字段中，**删除旧密钥**，**粘贴新的 API 密钥**
   - 确保 **Environment** 选项已全选（Production、Preview、Development）
   - 点击 **"Save"**（保存）

### 步骤3：重新部署

1. **在 Vercel 控制台**
   - 点击 **"Deployments"** 标签
   - 找到最新的部署
   - 点击右侧的 **"..."** 菜单
   - 选择 **"Redeploy"**（重新部署）

2. **等待部署完成**（约 2-3 分钟）

### 步骤4：测试

1. **刷新浏览器页面**
2. **再次点击"生成本节内容"按钮**
3. **应该可以正常生成内容了**

## 🔒 安全建议

### 如何避免 API 密钥泄露？

1. **不要在代码中硬编码 API 密钥**
   - ✅ 使用环境变量（如 Vercel 环境变量）
   - ❌ 不要提交到 Git 仓库

2. **不要在公开场合分享 API 密钥**
   - ✅ 只通过安全渠道分享（如加密消息）
   - ❌ 不要发布到论坛、GitHub、文档等公开平台

3. **定期轮换 API 密钥**
   - 建议每 3-6 个月更换一次
   - 如果怀疑泄露，立即更换

4. **限制 API 密钥权限**
   - 在 Google Cloud Console 中设置 API 密钥限制
   - 只允许必要的 API 访问

5. **监控 API 使用情况**
   - 定期检查 API 使用日志
   - 发现异常使用立即更换密钥

## ⚠️ 常见问题

### Q: 为什么 API 密钥会被标记为泄露？

A: 可能的原因：
- 密钥被提交到了公开的 Git 仓库
- 密钥被分享到了公开平台（论坛、文档等）
- 密钥被恶意软件窃取
- Google 检测到密钥在多个不相关的地方使用

### Q: 旧密钥还能用吗？

A: 不能。被标记为泄露的密钥会被 Google 禁用，无法继续使用。

### Q: 如何检查 API 密钥是否有效？

A: 
1. 在 Google AI Studio 中查看密钥状态
2. 尝试使用密钥调用 API
3. 检查 Vercel 部署日志

### Q: 更换密钥后仍然报错？

A: 
1. 确认新密钥已正确保存到 Vercel
2. 确认已重新部署
3. 等待几分钟让更改生效
4. 清除浏览器缓存并刷新页面

## 📋 检查清单

- [ ] 在 Google AI Studio 创建了新 API 密钥
- [ ] 在 Vercel 中更新了 `GEMINI_API_KEY` 环境变量
- [ ] 重新部署了项目
- [ ] 测试生成功能正常工作
- [ ] 删除了旧密钥（可选）

---

**完成以上步骤后，工具应该可以正常工作了！** 🎉

