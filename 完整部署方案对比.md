# 🚀 完整部署方案对比（给同事使用）

## 📊 方案对比表

| 方案 | 难度 | 费用 | 稳定性 | 国内访问 | 推荐度 |
|------|------|------|--------|----------|--------|
| **Vercel + ngrok** | ⭐ 简单 | 免费 | ⭐⭐⭐ | ✅ 可访问 | ⭐⭐⭐⭐⭐ |
| **Vercel + Cloudflare Tunnel** | ⭐⭐ 中等 | 免费 | ⭐⭐⭐⭐ | ✅ 可访问 | ⭐⭐⭐⭐ |
| **阿里云/腾讯云** | ⭐⭐ 中等 | 低（学生免费） | ⭐⭐⭐⭐⭐ | ✅ 完美 | ⭐⭐⭐⭐⭐ |
| **GitHub Codespaces** | ⭐ 简单 | 免费（有限额） | ⭐⭐⭐ | ⚠️ 可能慢 | ⭐⭐⭐ |
| **本地服务器** | ⭐⭐⭐ 复杂 | 免费 | ⭐⭐⭐⭐ | ✅ 完美 | ⭐⭐⭐ |

---

## 🎯 方案1：Vercel + ngrok（推荐，最简单）

### ✅ 优点
- ✅ 完全免费
- ✅ 不需要信用卡
- ✅ 国内可访问
- ✅ 设置简单（10分钟）

### ❌ 缺点
- ⚠️ 每次重启 ngrok，URL 会变化
- ⚠️ 需要保持电脑运行

### 📝 步骤

1. **安装 ngrok**：
   - 访问：https://ngrok.com/download
   - 下载 Windows 版本
   - 解压到项目目录

2. **注册 ngrok**：
   - 访问：https://dashboard.ngrok.com/signup
   - 注册账号
   - 获取 Authtoken

3. **配置 ngrok**：
   ```powershell
   ngrok config add-authtoken YOUR_TOKEN
   ```

4. **启动服务**：
   ```powershell
   # 窗口1：启动后端
   cd F:\ProReport-GenAI
   npm run dev:server
   
   # 窗口2：启动 ngrok
   ngrok http 3001
   ```

5. **获取 URL**：
   - 复制 ngrok 显示的 HTTPS URL
   - 例如：`https://abc123.ngrok-free.app`

6. **配置 Vercel**：
   - 在 Vercel 设置环境变量：`VITE_API_URL = https://abc123.ngrok-free.app/api`
   - 重新部署前端

### 💰 费用：完全免费

---

## 🎯 方案2：Vercel + Cloudflare Tunnel（推荐，更稳定）

### ✅ 优点
- ✅ 完全免费
- ✅ 可以固定域名
- ✅ 国内可访问
- ✅ 比 ngrok 更稳定

### ❌ 缺点
- ⚠️ 配置稍复杂
- ⚠️ 需要保持电脑运行

### 📝 步骤

1. **安装 Cloudflare Tunnel**：
   - 访问：https://github.com/cloudflare/cloudflared/releases
   - 下载 Windows 版本

2. **登录 Cloudflare**：
   ```powershell
   cloudflared tunnel login
   ```

3. **创建隧道**：
   ```powershell
   cloudflared tunnel create proreport-backend
   ```

4. **运行隧道**：
   ```powershell
   cloudflared tunnel --url http://localhost:3001
   ```

5. **配置 Vercel**（同方案1）

### 💰 费用：完全免费

---

## 🎯 方案3：阿里云/腾讯云（最稳定，推荐长期使用）

### ✅ 优点
- ✅ 国内访问速度快
- ✅ 非常稳定
- ✅ 可以固定域名
- ✅ 学生免费（或低费用）

### ❌ 缺点
- ⚠️ 需要注册账号
- ⚠️ 可能需要实名认证
- ⚠️ 学生免费，非学生需要付费（但很便宜）

### 📝 步骤

#### 3.1 购买云服务器

**阿里云**：
- 访问：https://www.aliyun.com/
- 学生优惠：https://developer.aliyun.com/plan/student
- 选择轻量应用服务器（约 24元/月，学生免费）

**腾讯云**：
- 访问：https://cloud.tencent.com/
- 学生优惠：https://cloud.tencent.com/act/campus
- 选择轻量应用服务器（约 24元/月，学生免费）

#### 3.2 配置服务器

1. **连接服务器**（使用 SSH 或远程桌面）

2. **安装 Node.js**：
   ```bash
   # 使用 nvm 安装
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
   nvm install 18
   nvm use 18
   ```

3. **上传代码**：
   ```bash
   # 使用 Git
   git clone https://github.com/a706990060-sys/proreport-genai.git
   cd proreport-genai/server
   npm install
   ```

4. **配置环境变量**：
   ```bash
   # 创建 .env 文件
   nano .env
   ```
   内容：
   ```
   GEMINI_API_KEY=你的API密钥
   JWT_SECRET=你的JWT密钥
   FRONTEND_URL=https://你的前端URL
   NODE_ENV=production
   PORT=3001
   ```

5. **使用 PM2 运行**：
   ```bash
   npm install -g pm2
   npm run build
   pm2 start dist/index.js --name proreport-backend
   pm2 save
   pm2 startup
   ```

6. **配置 Nginx**（可选，用于反向代理）：
   ```bash
   sudo apt install nginx
   # 配置 Nginx 转发到 localhost:3001
   ```

7. **配置防火墙**：
   - 开放 3001 端口（或 80/443 如果使用 Nginx）

#### 3.3 获取服务器IP

- 服务器IP：`你的服务器公网IP`
- 后端URL：`http://你的服务器IP:3001` 或 `https://你的域名`

#### 3.4 配置 Vercel

- 在 Vercel 设置：`VITE_API_URL = http://你的服务器IP:3001/api`

### 💰 费用：
- **学生**：免费（需要学生认证）
- **非学生**：约 24-50元/月

---

## 🎯 方案4：GitHub Codespaces（适合测试）

### ✅ 优点
- ✅ 完全免费（有限额）
- ✅ 不需要本地运行
- ✅ 自动配置环境

### ❌ 缺点
- ⚠️ 免费版有使用限制
- ⚠️ 国内访问可能慢
- ⚠️ 需要 GitHub 账号

### 📝 步骤

1. **创建 Codespace**：
   - 访问你的 GitHub 仓库
   - 点击 "Code" → "Codespaces" → "Create codespace"

2. **在 Codespace 中运行后端**：
   ```bash
   cd server
   npm install
   npm run dev
   ```

3. **使用端口转发**：
   - Codespace 会自动创建端口转发
   - 复制公开的 URL

4. **配置 Vercel**（同方案1）

### 💰 费用：免费（每月60小时）

---

## 🎯 方案5：本地服务器（适合内网）

### ✅ 优点
- ✅ 完全免费
- ✅ 内网访问速度快
- ✅ 数据安全（不外泄）

### ❌ 缺点
- ⚠️ 只能内网访问
- ⚠️ 需要固定IP或域名
- ⚠️ 需要配置路由器

### 📝 步骤

1. **在本地电脑运行后端**：
   ```powershell
   cd F:\ProReport-GenAI
   npm run dev:server
   ```

2. **获取本机IP**：
   ```powershell
   ipconfig
   # 找到 IPv4 地址，例如：192.168.1.100
   ```

3. **配置路由器端口转发**（如果需要外网访问）：
   - 登录路由器管理界面
   - 设置端口转发：3001 → 你的电脑IP

4. **配置 Vercel**：
   - 如果只是内网使用，可以：
     - 前端也部署在本地
     - 或使用内网IP：`VITE_API_URL = http://192.168.1.100:3001/api`

### 💰 费用：完全免费

---

## 🎯 方案6：使用 Docker + 云服务器（最专业）

### ✅ 优点
- ✅ 环境一致
- ✅ 易于部署
- ✅ 可以多实例运行

### ❌ 缺点
- ⚠️ 需要学习 Docker
- ⚠️ 需要云服务器

### 📝 步骤

1. **创建 Dockerfile**（已创建）

2. **构建镜像**：
   ```bash
   docker build -t proreport-backend -f Dockerfile.backend .
   ```

3. **运行容器**：
   ```bash
   docker run -d -p 3001:3001 \
     -e GEMINI_API_KEY=你的密钥 \
     -e JWT_SECRET=你的密钥 \
     -e FRONTEND_URL=你的前端URL \
     proreport-backend
   ```

4. **部署到云服务器**（同方案3）

### 💰 费用：取决于云服务器

---

## 🎯 推荐方案（按场景）

### 🏃 快速测试（1小时内）
**推荐：方案1（Vercel + ngrok）**
- 最简单、最快
- 适合临时测试

### 👥 给同事使用（长期）
**推荐：方案3（阿里云/腾讯云）**
- 最稳定
- 国内访问快
- 可以固定域名

### 🏢 公司内网使用
**推荐：方案5（本地服务器）**
- 数据安全
- 访问速度快
- 完全免费

### 🧪 开发测试
**推荐：方案4（GitHub Codespaces）**
- 不需要本地环境
- 自动配置

---

## 📝 通用步骤（所有方案都需要）

### 1. 部署前端到 Vercel（已完成）

### 2. 获取后端URL

根据选择的方案，获取后端URL：
- ngrok: `https://xxx.ngrok-free.app`
- Cloudflare: `https://xxx.trycloudflare.com`
- 云服务器: `http://你的IP:3001` 或 `https://你的域名`
- 本地: `http://localhost:3001` 或 `http://你的内网IP:3001`

### 3. 配置 Vercel 环境变量

1. 访问 Vercel 项目
2. Settings → Environment Variables
3. 添加：`VITE_API_URL = 你的后端URL/api`
4. 重新部署

### 4. 测试

1. 访问前端URL
2. 尝试注册/登录
3. 创建项目
4. 检查浏览器控制台（F12）确认API调用成功

---

## 🆘 遇到问题？

### 无法访问后端

- 检查后端服务是否运行
- 检查防火墙设置
- 检查端口是否正确

### API调用失败

- 检查 `VITE_API_URL` 是否正确
- 检查 CORS 配置
- 查看浏览器控制台错误

### 部署后无法使用

- 检查环境变量是否正确
- 检查后端日志
- 确认前后端URL匹配

---

## 🎉 总结

**最简单**：方案1（ngrok）
**最稳定**：方案3（云服务器）
**最安全**：方案5（内网）

选择最适合你的方案即可！

