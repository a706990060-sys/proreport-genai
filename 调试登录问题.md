# 🔍 调试"登录已过期"问题

## 📋 问题现象

登录后，点击创建新项目时仍然提示"登录已过期"。

## 🔧 已添加的调试功能

我已经添加了详细的调试日志，现在可以：

1. **查看浏览器控制台**（F12 → Console标签）
2. **查看网络请求**（F12 → Network标签）

## 🧪 调试步骤

### 步骤1：检查登录时token是否保存

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 重新登录
4. 查看控制台输出，应该看到：
   ```
   登录API返回: {success: true, data: {...}}
   保存token: 存在(XXX字符)
   验证token已保存: 成功(XXX字符)
   ```

### 步骤2：检查LocalStorage中的token

1. 打开浏览器开发者工具（F12）
2. 切换到 **Application** 标签
3. 展开 **Local Storage** → `http://localhost:3000`
4. 查找 `auth_token` 键
5. 确认token是否存在且不为空

### 步骤3：检查创建项目时的token传递

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 点击"新建项目"
4. 查看控制台输出，应该看到：
   ```
   创建项目 - 检查token: 存在 ...
   API请求 /projects: token存在，长度=XXX
   ```

### 步骤4：检查网络请求

1. 打开浏览器开发者工具（F12）
2. 切换到 **Network** 标签
3. 点击"新建项目"
4. 找到 `/api/projects` 请求（POST方法）
5. 点击该请求，查看：
   - **Headers** → **Request Headers** → 应该看到 `Authorization: Bearer ...`
   - **Response** → 查看返回的错误信息

### 步骤5：检查后端日志

1. 查看后端终端输出
2. 应该看到请求日志
3. 如果有错误，会显示具体的错误信息

## 🐛 常见问题排查

### 问题1：token没有保存

**症状：** 控制台显示"验证token已保存: 失败"

**解决方法：**
1. 检查浏览器是否禁用了LocalStorage
2. 尝试清除浏览器缓存后重新登录
3. 检查是否有其他脚本清除了token

### 问题2：token格式错误

**症状：** 控制台显示token存在，但创建项目时仍然失败

**解决方法：**
1. 检查token是否完整（应该是一长串字符串）
2. 检查token是否包含特殊字符导致问题
3. 尝试重新登录获取新token

### 问题3：后端JWT_SECRET不匹配

**症状：** 后端返回"无效的认证令牌"

**解决方法：**
1. 检查 `server/.env` 文件中的 `JWT_SECRET`
2. 确保后端重启后JWT_SECRET没有改变
3. 如果改变了，所有用户需要重新登录

### 问题4：token过期

**症状：** token存在，但后端验证失败

**解决方法：**
1. JWT token默认有效期7天
2. 如果超过7天，需要重新登录
3. 检查token的创建时间

## 📝 测试步骤

1. **清除旧token**：
   - Application → Local Storage → 删除 `auth_token`

2. **重新登录**：
   - 输入用户名和密码
   - 点击登录
   - 查看控制台日志

3. **验证token**：
   - 检查LocalStorage中是否有 `auth_token`
   - 检查控制台是否显示token已保存

4. **创建项目**：
   - 点击"新建项目"
   - 填写项目名称
   - 选择大纲类型
   - 查看控制台和网络请求

## 🔍 需要提供的信息

如果问题仍然存在，请提供：

1. **浏览器控制台日志**（Console标签的完整输出）
2. **网络请求详情**（Network标签中 `/api/projects` 请求的Headers和Response）
3. **LocalStorage内容**（Application标签中 `auth_token` 的值，可以只显示前20个字符）
4. **后端日志**（后端终端的错误信息）

## ✅ 预期结果

正常情况下，应该看到：

1. 登录成功 → token保存成功
2. 创建项目 → token正确传递
3. 后端验证 → 返回成功
4. 项目创建 → 成功创建并显示

如果所有步骤都正常，但仍然失败，可能是后端配置问题。

