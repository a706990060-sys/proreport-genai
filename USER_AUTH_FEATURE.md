# 用户登录功能说明

## 功能概述

已成功为 ProReport GenAI 添加了用户登录和注册功能，实现了用户数据的完全隔离存储。

## 新增功能

### 1. 用户认证系统
- **用户注册**：新用户可以创建账户（用户名至少3个字符，密码至少6个字符）
- **用户登录**：已注册用户可以登录
- **用户登出**：用户可以安全登出
- **会话管理**：登录状态持久化，刷新页面后保持登录

### 2. 数据隔离
- **独立存储**：每个用户的数据存储在独立的 localStorage 键中
- **数据隔离**：不同用户之间的项目、资料库、自定义分组完全隔离
- **向后兼容**：未登录用户仍可使用默认存储（兼容旧数据）

### 3. 用户界面
- **登录界面**：美观的登录/注册界面
- **用户信息显示**：顶部导航栏显示当前登录用户名
- **登出按钮**：方便用户切换账户

## 文件结构

### 新增文件
- `services/authService.ts` - 用户认证服务
- `components/LoginView.tsx` - 登录/注册界面组件
- `USER_AUTH_FEATURE.md` - 本说明文档

### 修改文件
- `types.ts` - 添加 User 和 UserCredentials 接口
- `App.tsx` - 集成用户认证，修改数据存储逻辑

## 数据存储结构

### 用户数据存储键格式
- 项目数据：`pro_report_projects_{userId}`
- 资料库：`pro_report_library_{userId}`
- 自定义分组：`pro_report_custom_groups_{userId}`

### 全局数据（所有用户共享）
- 用户列表：`pro_report_users`
- 用户密码哈希：`pro_report_user_passwords`
- 当前登录用户ID：`pro_report_current_user_id`

## 使用方法

### 首次使用
1. 打开应用，会看到登录界面
2. 点击"注册"标签
3. 输入用户名（至少3个字符）和密码（至少6个字符）
4. 可选填写邮箱
5. 点击"注册"按钮
6. 注册成功后自动登录

### 登录
1. 在登录界面输入用户名和密码
2. 点击"登录"按钮

### 切换用户
1. 点击顶部导航栏的"登出"按钮
2. 使用其他账户登录

## 安全说明

### 密码存储
- 密码使用简单的哈希算法存储（生产环境建议使用更安全的 bcrypt）
- 密码哈希存储在 localStorage 中
- 原始密码不会保存

### 数据安全
- 每个用户的数据完全隔离
- 用户无法访问其他用户的数据
- 删除账户会清除该用户的所有数据

## 注意事项

1. **本地存储**：所有数据存储在浏览器 localStorage 中
   - 清除浏览器数据会丢失所有数据
   - 不同浏览器之间的数据不共享
   - 建议定期导出重要项目

2. **密码安全**：
   - 当前使用简单的哈希算法（适合本地应用）
   - 生产环境建议使用更安全的密码加密方式
   - 建议用户使用强密码

3. **数据迁移**：
   - 旧数据（未登录时创建的数据）会保留在默认键中
   - 新用户登录后创建的数据会存储在用户特定的键中
   - 建议用户登录后重新创建项目，或手动迁移数据

## 技术实现

### 认证流程
1. 应用启动时检查 `pro_report_current_user_id`
2. 如果存在，加载用户信息并显示应用界面
3. 如果不存在，显示登录界面

### 数据加载
1. 用户登录成功后，使用用户ID加载该用户的数据
2. 所有数据操作都使用用户特定的存储键

### 数据保存
1. 所有数据保存时自动使用当前用户的存储键
2. 确保数据隔离和安全性

## 未来改进建议

1. **密码加密**：使用 bcrypt 或类似的安全哈希算法
2. **数据同步**：添加云端同步功能（需要后端支持）
3. **密码重置**：添加忘记密码功能
4. **用户设置**：添加用户个人设置页面
5. **数据导出/导入**：添加用户数据导出和导入功能

