# 🚀 本地部署 + 内网穿透方案（无需信用卡，国内可用）

如果无法访问 Cyclic.sh，可以使用本地部署 + 内网穿透的方式，让其他用户通过公网访问你的后端。

---

## 方案1：使用 ngrok（推荐，最简单）

### ✅ 优点
- ✅ 完全免费
- ✅ 不需要信用卡
- ✅ 国内可访问
- ✅ 自动HTTPS
- ✅ 非常简单

### 📥 步骤1：安装 ngrok

#### Windows 安装方法

1. **访问 ngrok 官网**：
   - 如果无法访问，使用镜像：https://ngrok.com/download
   - 或使用国内镜像下载

2. **下载 Windows 版本**：
   - 下载 `ngrok.zip`
   - 解压到任意目录，例如：`C:\ngrok`

3. **添加到 PATH**（可选）：
   - 按 `Win + R`，输入 `sysdm.cpl`
   - 高级 → 环境变量 → 系统变量 → Path → 编辑
   - 新建 → 输入：`C:\ngrok`
   - 确定保存

### 🔐 步骤2：注册 ngrok 账号

1. 访问：https://dashboard.ngrok.com/signup
2. 注册账号（可以使用 GitHub 登录）
3. 登录后，进入：https://dashboard.ngrok.com/get-started/your-authtoken
4. **复制你的 Authtoken**（类似：`2abc123def456ghi789jkl012mno345pq`）

### 🔑 步骤3：配置 ngrok

打开 PowerShell，运行：

```powershell
# 配置 authtoken（替换为你的token）
ngrok config add-authtoken YOUR_AUTH_TOKEN_HERE
```

### 🚀 步骤4：启动后端服务

在项目目录，启动后端：

```powershell
cd F:\ProReport-GenAI
npm run dev:server
```

或者使用批处理文件：
```powershell
.\启动工具.bat
```

### 🌐 步骤5：启动 ngrok 隧道

**打开新的 PowerShell 窗口**，运行：

```powershell
ngrok http 3001
```

你会看到类似输出：
```
Forwarding  https://abc123.ngrok-free.app -> http://localhost:3001
```

**重要：复制这个 HTTPS URL！**（例如：`https://abc123.ngrok-free.app`）

### 🔗 步骤6：配置前端

#### 6.1 在 Vercel 添加环境变量

1. 访问 Vercel 项目：https://vercel.com/dashboard
2. 选择你的前端项目
3. 进入 **Settings** → **Environment Variables**
4. 添加：
   - **Key**: `VITE_API_URL`
   - **Value**: `https://abc123.ngrok-free.app/api`（替换为你的ngrok URL）
   - **Environment**: 选择 `Production`, `Preview`, `Development`（全选）

5. 点击 **"Save"**

#### 6.2 重新部署前端

1. 在 Vercel 控制台
2. 进入 **Deployments** 标签
3. 找到最新的部署
4. 点击 **"..."** → **"Redeploy"**
5. 等待重新部署完成

### ⚠️ 注意事项

1. **免费版限制**：
   - 每次重启 ngrok，URL 会变化
   - 需要重新在 Vercel 更新 `VITE_API_URL`

2. **保持运行**：
   - 后端服务必须一直运行
   - ngrok 隧道必须一直运行
   - 关闭后，URL 会失效

3. **升级到固定域名**（可选）：
   - ngrok 付费版可以固定域名
   - 或使用其他内网穿透工具（见下方）

---

## 方案2：使用 frp（国内推荐）

### ✅ 优点
- ✅ 完全免费
- ✅ 可以固定域名
- ✅ 国内速度快
- ✅ 开源

### 📥 步骤1：准备服务器

你需要：
- 一台有公网IP的服务器（VPS）
- 或使用免费的云服务器（如阿里云、腾讯云学生机）

### 📥 步骤2：安装 frp

1. 下载 frp：https://github.com/fatedier/frp/releases
2. 在服务器上安装 frp 服务端
3. 在本地安装 frp 客户端

### 🔧 步骤3：配置 frp

配置较复杂，需要：
- 服务器端配置
- 客户端配置
- 域名解析（可选）

**详细教程**：https://github.com/fatedier/frp

---

## 方案3：使用 Cloudflare Tunnel（免费，推荐）

### ✅ 优点
- ✅ 完全免费
- ✅ 不需要信用卡
- ✅ 可以固定域名
- ✅ 国内可访问（部分）

### 📥 步骤1：安装 Cloudflare Tunnel

```powershell
# 下载 cloudflared
# 访问：https://github.com/cloudflare/cloudflared/releases
# 下载 Windows 版本
```

### 🔐 步骤2：登录 Cloudflare

```powershell
cloudflared tunnel login
```

### 🚀 步骤3：创建隧道

```powershell
cloudflared tunnel create proreport-backend
```

### 🌐 步骤4：运行隧道

```powershell
cloudflared tunnel --url http://localhost:3001
```

---

## 方案4：使用本地部署脚本（最简单）

创建一个批处理文件，自动启动后端和 ngrok：

### 创建 `启动后端+内网穿透.bat`

```batch
@echo off
chcp 65001 >nul
echo ========================================
echo 🚀 启动后端 + 内网穿透
echo ========================================
echo.

REM 启动后端（后台）
start "后端服务" cmd /k "cd /d F:\ProReport-GenAI && npm run dev:server"

REM 等待3秒
timeout /t 3 /nobreak >nul

REM 启动 ngrok
echo 正在启动 ngrok 隧道...
echo.
start "ngrok隧道" cmd /k "ngrok http 3001"

echo.
echo ✅ 后端和 ngrok 已启动！
echo.
echo 📝 请查看 ngrok 窗口，复制 HTTPS URL
echo 📝 然后在 Vercel 中更新 VITE_API_URL
echo.
pause
```

---

## 🎯 推荐方案

**如果你只是想让其他用户使用**：

1. **最简单**：使用 **ngrok**（方案1）
   - 免费、简单、快速
   - 每次重启 URL 会变，需要更新 Vercel

2. **最稳定**：使用 **Cloudflare Tunnel**（方案3）
   - 免费、可以固定域名
   - 配置稍复杂

3. **最专业**：使用 **frp**（方案2）
   - 需要自己的服务器
   - 最灵活、最稳定

---

## ✅ 完成后的操作

1. 获取公网URL（如：`https://abc123.ngrok-free.app`）
2. 在 Vercel 设置 `VITE_API_URL` = `https://abc123.ngrok-free.app/api`
3. 重新部署前端
4. 分享前端URL给其他用户

---

## 🆘 遇到问题？

### ngrok 无法连接

- 检查防火墙是否阻止
- 尝试更换网络（如手机热点）
- 检查后端服务是否正常运行

### URL 经常变化

- 考虑升级 ngrok 付费版
- 或使用 Cloudflare Tunnel
- 或使用 frp 固定域名

---

## 🎉 完成！

使用本地部署 + 内网穿透，你就可以：
- ✅ 不需要信用卡
- ✅ 不需要访问国外网站
- ✅ 完全免费
- ✅ 让其他用户通过公网访问

